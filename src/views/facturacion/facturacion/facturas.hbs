<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.80.0">
    <title>Thomson - Facturacion</title>



    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/facturacion-forms.css">
    <link rel="stylesheet" href="/css/select.css" />

    <!-- Favicons -->


    <!-- Custom styles for this template -->
    <link href="/css/dashboard.css" rel="stylesheet">
</head>

<body>
    <header>
        <nav class="navbar navbar-expand-md navbar-dark bg-dark ">
            <div class="container-fluid">
                <a href="/Facturacion">
                    <img src="/css/assets/logo.png" alt="LOGO" width="150px" height="30px" id="logo" />
                </a>
                <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="toggle navigation">
                    <span class="navbar-toggler-icon"> </span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto">
                        
                        <li class="nav-item dropdown">
                            <a class="nav-link active dropdown-toggle" id="navbarDropdownMenuLink"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Facturación</a>
                            <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdownMenuLink">
                                <li><a class="nav-link" href="/facturacion/nueva-factura">Nueva-factura</a></li>
                                <li class="dropdown-submenu"><a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Facturas</a>
                                    <ul class="dropdown-menu dark2 bg-dark">
                                        <li><a class="nav-link" href="/facturacion/por-cobrar">Por cobrar</a></li>
                                        <li><a class="nav-link" href="/facturacion/cobradas">Cobradas</a></li>
                                        <li><a class="nav-link" href="/facturacion/ventas">Ventas</a></li> <!--Todas -->
                                        <li><a class="nav-link" href="/facturacion/anular-factura">Anular</a></li>
                                        <li><a class="nav-link" href="/facturacion/ordenes-compra">Orden de compra</a></li> <!--Pedidos de los clientes-->
                                        <li><a class="nav-link" href="/facturacion/nueva-cotizacion">Cotización</a></li> 
                                        <li><a class="nav-link" href="/facturacion/ver-cotizaciones">Ver cotizaciones</a></li> 
                                        <li><a class="nav-link" href="/facturacion/libro-contable">Libro contable</a></li> <!--Realizar cotizaciones sin afectar stock-->
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Cobranza</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class=" dropdown-item text-light" href="/facturacion/cobranza">
                                    <p class="name_product nav-link">Cobranza</p>
                                </a>
                                  <a class=" dropdown-item text-light" href="/facturacion/devolucion">
                                    <p class="name_product nav-link">Realizar Devolución</p>
                                </a>
                                <a class=" dropdown-item text-light" href="/facturacion/todas-devoluciones">
                                    <p class="name_product nav-link">Devoluciones</p>
                                </a>
                                <a class=" dropdown-item text-light" href="/facturacion/todos-recibos">
                                    <p class="name_product nav-link">Recibos de pago</p>
                                </a>
                                <a class=" dropdown-item text-light" href="/facturacion/reporte-cxc">
                                    <p class="name_product nav-link">Reporte de cuentas por cobrar</p>
                                </a>
                                
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Inventario</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class=" dropdown-item text-light" href="/facturacion/registrar-stock">
                                    <p class="name_product nav-link">Crear Artículo</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/stock">
                                    <p class="name_product nav-link">Editar Artículo</p>
                                </a>
                                      <a class=" dropdown-item text-light" href="/facturacion/registrar-garantias">
                                    <p class="name_product nav-link">Registrar garantías</p>
                                </a>
                                    <a class=" dropdown-item text-light" href="/facturacion/ver-garantias">
                                    <p class="name_product nav-link">Ver garantías</p>
                                </a>
                                </a>
                                    <a class=" dropdown-item text-light" href="/facturacion/estado-inventario">
                                    <p class="name_product nav-link">Estado de inventario</p>
                                </a>
                                 <a class=" dropdown-item text-light" href="/facturacion/reporte-ajustes">
                                    <p class="name_product nav-link">Reporte de movimientos</p>
                                </a>
                               <a class=" dropdown-item text-light" href="/facturacion/reporte-de-articulos">
                                    <p class="name_product nav-link">Reporte de articulos</p>
                                </a>
                                  <a class=" dropdown-item text-light" href="/facturacion/cambio-masivo-costo">
                                    <p class="name_product nav-link">Cambio masivo de costos</p>
                                </a>
                                  <a class=" dropdown-item text-light" href="/facturacion/reporte-stock">
                                    <p class="name_product nav-link">Reporte de stock</p>
                                </a>
                                  <li class="dropdown-submenu"><a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Ajuste de inventario</a>
                                    <ul class="dropdown-menu dark2 bg-dark">
                                        <li><a class="nav-link" href="/facturacion/descargar-stock">Descargar</a></li>
                                        <li><a class="nav-link" href="/facturacion/cargar-stock">Cargar</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>

                        <li>
                            <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Proveedor</a>
                                <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                    <a class=" dropdown-item text-light" href="/facturacion/crear-proveedor">
                                        <p class="name_product nav-link">Crear</p>
                                    </a>
                                    <a class="dropdown-item text-light" href="/facturacion/editar-proveedor">
                                        <p class="name_product nav-link">Editar</p>
                                    </a>
                                        <a class="dropdown-item text-light" href="/facturacion/realizar-ordenes">
                                        <p class="name_product nav-link">Realizar orden</p>
                                    </a>
                                    <a class="dropdown-item text-light" href="/facturacion/ordenes-proveedor">
                                        <p class="name_product nav-link">Lista de ordenes</p>
                                    </a>
                                    <a class="dropdown-item text-light" href="/facturacion/reporte-de-proveedores">
                                        <p class="name_product nav-link">Reporte de proveedores</p>
                                    </a>
                                </ul>
                            </li>
                        </li>

                        <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">Cliente</a>
                        <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                            <a class=" dropdown-item text-light" href="/facturacion/registrar-cliente">
                                <p class="name_product nav-link">Registrar</p>
                            </a>
                            <a class="dropdown-item text-light" href="/facturacion/clientes">
                                <p class="name_product nav-link">Editar</p>
                            </a>
                            <a class="dropdown-item text-light" href="/facturacion/aprobar-usuarios">
                                <p class="name_product nav-link">Aprobar o rechazar</p>
                            </a>
                            <a class="dropdown-item text-light" href="/facturacion/pausar-activar-cliente">
                                <p class="name_product nav-link">Pausar o activar</p>
                            </a>
                            <a class="dropdown-item text-light" href="/facturacion/reporte-cliente">
                                <p class="name_product nav-link">Reportes</p>
                            </a>
                            <a class="dropdown-item text-light" href="/facturacion/reportes-precio">
                                <p class="name_product nav-link">Lista de precios</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/solicitudes-recuperacion-contrasena">
                                <p class="name_product nav-link">Solicitudes de recuperación</p>
                            </a>
                        </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Vendedor</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class=" dropdown-item text-light" href="/facturacion/registrar-vendedor">
                                    <p class="name_product nav-link">Registrar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/vendedores">
                                    <p class="name_product nav-link">Editar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/reporte-vendedores">
                                    <p class="name_product nav-link">Reportes</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/pausar-activar-vendedor">
                                    <p class="name_product nav-link">Pausar o activar</p>
                                </a>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Transporte</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                               <a class=" dropdown-item text-light" href="/facturacion/registrar-transporte">
                                    <p class="name_product nav-link">Registrar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/transportes">
                                    <p class="name_product nav-link">Editar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/activar-inactivar-transporte">
                                    <p class="name_product nav-link">Pausar o activar</p>
                                </a>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Registrar perfil</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class=" dropdown-item text-light" href="/facturacion/registrar-usuario">
                                    <p class="name_product nav-link">Registrar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/usuarios">
                                    <p class="name_product nav-link">Editar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/pausar-activar-usuario">
                                    <p class="name_product nav-link">Pausar o activar</p>
                                </a>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Comisión</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item text-light" href="/facturacion/comision/por-cancelar">
                                    <p class="name_product nav-link">Por cancelar</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/comision/canceladas">
                                    <p class="name_product nav-link">Canceladas</p>
                                </a>
                            </ul>
                        </li>

                        <li class="nav-item dropdown">
                             <a class="nav-link dropdown-toggle" id="navbarDropdown" role="button"
                                data-bs-toggle="dropdown" aria-expanded="false">Administración</a>
                                   <ul class="dropdown-menu dark2 bg-dark" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item text-light" href="/facturacion/administracion">
                                    <p class="name_product nav-link">Libro de entradas y salidas</p>
                                </a>
                                <a class="dropdown-item text-light" href="/facturacion/cuentas-por-pagar">
                                    <p class="name_product nav-link">Cuentas por pagar</p>
                                </a>
                            </ul>
                        </li>
                         <li class="nav-item">
                            <a class="nav-link" href="/facturacion/agenda">Agenda</a>
                        </li>
                        
                         <li class="nav-item">
                            <a class="nav-link" href="/facturacion/dashboard">Dashboard</a>
                        </li>

                    </ul>
                       <ul class="navbar-nav ml-0 mr-0">
                            <li class="nav-item">
                                <a class="nav-link" href="/usuarios/cerrar-sesion">
                                    <button class="btn btn-outline-success" type="button">
                                        Cerrar sesión
                                    </button>
                                </a>
                            </li>
                        </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
      <div  hidden id="spinner"></div>
      <h3 class="text-light text-center mb-3">TODAS LAS FACTURAS</h3>
      <div class="row mt-4 mb-2 mx-auto">
          <div class="col-sm-3">
              <label class="text-light">Desde:</label>
              <input type="date"  class="form-control" id="Desde">
          </div>
          <div class="col-sm-3">
              <label class="text-light">Hasta:</label>
              <input type="date"  class="form-control" id="Hasta">
          </div>
          <div class="col-sm-3">
              <label class="text-light">Cliente</label>
                <select class="form-control js-exam" id="Cliente">
                    <option value="0">--Todos los clientes--</option>
                    {{#each Clientes}}
                    <option value="{{Cliente}}">{{Cliente}}</option>
                    {{/each}}
                </select>
          </div>
          <div class="col-sm-3 mt-4" id="contenedorBoton2">
              <button class="btn btn-success" id="Filtrar">Filtrar</button>
          </div>
          <div class="col-sm-12 mt-4 text-end">
          <a href="/descargar-pdf-ventas" class="btn btn-outline-warning" target="_blank">Ver PDF</a>
          </div>
      </div>
   
        <div class="table-responsive">
            <form action="/">
                <table id="tabla" class="table table-dark table-striped table-hover table-sm">
                    <thead class="">
                        <tr>
                            <th class="h6 text-center">Factura</th>
                            <th class="h6 text-center">Fecha de registro</th>
                            <th class="h6 text-center">Fecha de vencimiento</th>
                            <th class="h6 text-center">Cliente</th>
                            <th class="h6 text-center">Documento</th>
                            <th class="h6 text-center">Productos</th>
                            <th class="h6 text-center">Neto</th>
                            <th class="h6 text-center">Saldo</th>
                            <th class="h6 text-center">Ver factura</th>
                            <th class="h6 text-center">Historial de pagos</th>
                            <th class="h6 text-center">Ajustar vencimiento</th>
                        </tr>
                        <td colspan="11">
                            <input id="buscar" type="text" class="form-control" placeholder="Escriba su busqueda para filtar" />
                        </td>
                    </thead>
                    <tbody id="tbody">
                        {{#each facturas}}
                        <tr>
                            <td class="text-center text-light"> {{Factura}} </td>
                            <td class="text-center text-light"> {{date}} </td>
                            <td class="text-center text-light"> {{Vencimiento}} </td>
                            <td class="text-center text-light"> {{Cliente}} </td>
                            <td class="text-center text-light"> {{Documento}} </td>
                            <td class="text-center text-light"> {{CantidadTotal}} </td>
                            <td class="text-center text-light"> {{PrecioTotal}} </td>
                            <td class="text-center text-light"> {{PendienteAPagar}} </td>
                            <td class="text-center text-light">
                                <a href="/model-print/{{Factura}}" class="text-info">Ver</a>
                            </td>
                            <td class="text-center text-light">
                                <a href="/facturacion/historial-pagos/{{_id}}" class="text-primary">Historial</a>
                            </td>
                            <td class="text-center text-light">
                                <a href="/factura-ajustar-vencimiento/{{_id}}" class="text-success">Ajustar</a>
                            </td>
                        </tr>
                        {{/each}}

                    </tbody>
                       <tfoot>
                        <tr>
                            <td colspan="5" class="text-end text-danger">Totales:</td>
                            <td class="text-center text-light" id="CantidadTotal"></td>
                            <td class="text-center text-light" id="NetoTotal"></td>
                            <td class="text-center text-light" id="SaldoTotal"></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tfoot>
                </table>
        </div>
    </main>

    <script src="/js/bootstrap.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    

<footer class="footer" style="background-color: rgba(41, 41, 41, 0.99);">
    <div class="container-fluid text-center mt-2">
        <span class="text-muted">SISTEMA ADMINISTRATIVO THOMSON</span>
    </div>
</footer>
</body>
<script>
    const d= document,
    $Desde = d.getElementById("Desde"), 
    $Hasta = d.getElementById("Hasta"), 
    $Cliente = d.getElementById("Cliente"),
    $BtnFiltrar = d.getElementById("Filtrar"),
    busqueda = d.getElementById('buscar'),
    table = d.getElementById("tabla").tBodies[0],
    $tbody = d.getElementById("tbody"),
    $CantidadTotal = d.getElementById("CantidadTotal"),
    $SaldoTotal = d.getElementById("SaldoTotal"),
    $NetoTotal = d.getElementById("NetoTotal"),
    $spinner = d.getElementById("spinner")

    const solicitarInfo = async (data) => {
        return await fetch("/solicitar-info-facturas", {
            method: "POST",
            body: JSON.stringify(data),
            headers: {
            "Content-type": "application/json; charset=utf-8",
            },
        })
            .then((response) => {
            return response.json();
            })
            .then((response) => {
                let tr = ""
                let CantidadTotal = 0
                let PendienteTotal = 0
                let NetoTotal = 0
                for(i=0; i < response.length; i++){
                    CantidadTotal += +response[i].CantidadTotal
                    PendienteTotal += +response[i].PendienteAPagar2
                    NetoTotal += +response[i].PrecioTotal3
                    let linea = `
                        <tr>
                            <td class="text-center text-light">${response[i].Factura}</td>
                            <td class="text-center text-light">${response[i].date}</td>
                            <td class="text-center text-light">${response[i].Vencimiento}</td>
                            <td class="text-center text-light">${response[i].Cliente}</td>
                            <td class="text-center text-light">${response[i].Documento}</td>
                            <td class="text-center text-light">${response[i].CantidadTotal}</td>
                            <td class="text-center text-light">${response[i].PrecioTotal}</td>
                            <td class="text-center text-light">${response[i].PendienteAPagar}</td>
                            <td class="text-center text-light">
                                <a href="/model-print/${response[i].Factura}" class="text-success">Ver</a>
                            </td>
                            <td class="text-center text-light">
                                <a href="/facturacion/historial-pagos/${response[i]._id}" class="text-success">Historial</a>
                            </td>
                            <td class="text-center text-light">
                                <a href="/factura-ajustar-vencimiento/${response[i]._id}" class="text-success">Ajustar</a>
                            </td>
                        </tr>
                        `
                    tr += linea
                }
                $CantidadTotal.textContent = CantidadTotal
                $SaldoTotal.textContent =  new Intl.NumberFormat("en-US", {  style: "currency",  currency: "USD",}).format(PendienteTotal)
                $NetoTotal.textContent =  new Intl.NumberFormat("en-US", {  style: "currency",  currency: "USD",}).format(NetoTotal)
                $tbody.innerHTML = tr
                $spinner.setAttribute("hidden","")

            });
        };

        d.addEventListener("click", e=> {
            if(e.target == $BtnFiltrar){
                if(!$Hasta.value && $Desde.value || !$Desde.value && $Hasta.value ){
                    //error El camnpo "Desde" y "Hasta" deben estar llenos, o en su defecto estar vacios ambos
                }else{
                    if($Desde.value){
                        let data = {
                            Cliente: $Cliente.value,
                            Hasta: $Hasta.value,
                            Desde:$Desde.value 
                        }
                        solicitarInfo(data)
                        $spinner.removeAttribute("hidden")
                    }else{
                        let data = {
                            Cliente: $Cliente.value,
                        }
                        solicitarInfo(data)
                        $spinner.removeAttribute("hidden")
                    }
                }
            }
        })

    
    $(document).ready(function () {
        $(".js-exam").select2();
    })
    document.addEventListener("keydown", e => {
        if(e.keyCode == 120 ){
            window.open('/facturacion/acceso-directo-stock', 'Stock', "width=1400, heigh=100%")
        }
    })
    busqueda.addEventListener("keydown", e => {
        if(e.keyCode == 13){
        e.preventDefault()
        }
    })
    buscaTabla = function () {
        texto = busqueda.value.toLowerCase();
        let r = 0;
        while (row = table.rows[r++]) {
            if (row.innerText.toLowerCase().indexOf(texto) !== -1)
                row.style.display = null;
            else
                row.style.display = 'none';
        }
    }
    busqueda.addEventListener('keyup', buscaTabla);

</script>
</html>